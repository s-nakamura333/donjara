<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ドンジャラ得点計算ツール</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>🀄 ドンジャラの得点計算ツールの開発</h1>
  <p><strong>日付：</strong>2025年4月24日</p>

  <h2>🎯 テーマ選定の理由</h2>
  <p>娘と遊ぶためにドンジャラを購入したが、上り役が多く子供には得点計算が大変だった。<br>
  そのため得点計算を自動化できるツールを開発できないかと考えた。<br>
  得点計算という業務に対し、自動化というアプローチで作業手順と計算ミスの低減を目指した。</p>

  <h2>🏭 想定業界</h2>
  <p>玩具業界</p>

  <h2>🏢 想定企業</h2>
  <p>株式会社バンダイナムコホールディングス<br>
  及び業務改善課題を抱える企業</p>

  <h2>👥 想定ポジション</h2>
  <p>ドンジャラ担当者、もしくは業務改善課題を抱える現場担当者</p>

  <h2>📚 背景</h2>
  <p>ドンジャラの対象年齢は６歳以上となっているが、現実として６歳には得点計算は難しい。<br>
  そのため「６歳でも扱える得点計算ツール」を用意することができれば、ファミリー層の消費者の購入へのハードルを下げることができる。</p>
  <p>参考：<a href="https://p-bandai.jp/item/item-1000216035/" target="_blank">ドンジャラNEO ゴジラ 商品ページ</a></p>

  <h2>🎯 目的</h2>
  <p>①小学生でも扱いやすい得点計算ツールをドンジャラの製品に付属させ、未経験者でも手軽にドンジャラを楽しめるようアピールできる。</p>
  <p>②本来、ユーザー自身で「全９種ある基本役のうちどれが成立しているかどうか、説明書を見て確認」「基本役が成立していれば全４０種ある加点役のうち成立しているものがあるかどうか、説明書を見て確認」「最終的な点数は何点なのか計算」といった作業が必要だった。<br>
  しかし本成果物を使用すれば「手牌を撮影」し、「アプリの文字認識の正誤を確認」するだけで得点計算が完了する。つまり得点計算に至る作業を大幅に削減することができる。<br>
  同時に計算を自動化することで人間による計算ミスを防ぐことができる。<br>
  「６歳でも扱える得点計算ツール」であるため、不慣れな作業担当者でも作業監督者に確認を取らずに作業を完了することができる。</p>

  <h2>📘 概要</h2>
  <p>対象商品：ドンジャラNEO ゴジラ<br>
  製品に付属のQRコードからアクセスできるWEB取扱説明書を使用。<br>
  参考：<a href="https://p-bandai.jp/item/item-1000216035/" target="_blank">ドンジャラNEO ゴジラ 商品ページ</a></p>
  <p><strong>【ドンジャラNEO ゴジラについて】</strong><br>
  株式会社バンダイナムコの商品、ドンジャラNEOシリーズの一つ。<br>
  9枚の手牌の内容で役を決め得点する。<br>
  牌は全82種類83枚。各牌には牌名と属性が存在。牌の背景色は属性ごとに分かれている。<br>
  例①ゴジラ(54)→属性「昭和ゴジラ」<br>
  例②メカキングギドラ→属性「平成怪獣」<br>
  例③メーサー兵器→属性「東宝メカ」<br>
  同じ属性の牌3枚で1セットとし、3セットそろえることを目指す。<br>
  3セット揃うといずれかの基本役が完成し、加点役の成立を確認した上で得点計算を行う。</p>
  <img src="docs/tokutensample.png" alt="得点計算サンプル図" style="width:100%; max-width:800px; margin-top:1em; border:1px solid #ccc;">
<p style="font-size:0.9em; color:#666;">▲ WEB取扱説明書より抜粋：基本役＋加点役の得点構成サンプル</p>

  <h2>📌 補足</h2>
  <p><strong>【基本役について】</strong><br>
  手牌を構成する3セットの各属性の組み合わせで基本役が成立する。<br>
  例：手牌を構成する3セットの属性が「昭和ゴジラ」「平成ゴジラ」「「シン」「－0.1」ゴジラ」だった場合<br>
  →基本役「ゴジラ一色セット」（18万点）が成立。<br>
  基本役は全9種存在し、手牌が複数の条件を満たす場合は得点の高い基本役を採用する。</p>
  <img src="docs/gojiraissyoku.png" alt="ゴジラ一色セットの例" style="width:100%; max-width:600px; margin-top:1em; border:1px solid #ccc;">
<p style="font-size:0.9em; color:#666;">▲ 基本役「ゴジラ一色セット」の例</p>
  <p><strong>【加点役について】</strong><br>
  基本役が成立した場合、加点役の成立の確認を行う。<br>
  加点役は「特定の牌が手牌に含まれているか」で成立する。<br>
  例：手牌に「ゴジラ(71)」「ヘドラ(71)」が含まれている場合<br>
  →加点役「ゴジラ対ヘドラセット」（6万点）が成立。<br>
  加点役は全40種存在し、手牌が複数の加点役の条件を満たす場合は条件を満たしたすべての加点役が成立する。</p>
  <img src="docs/gojiravshedora.png" alt="ゴジラ対ヘドラセットの例" style="width:100%; max-width:600px; margin-top:1em; border:1px solid #ccc;">
<p style="font-size:0.9em; color:#666;">▲ 加点役「ゴジラ対ヘドラセット」の例</p>

  <h2>🛠 アプローチの理由</h2>
  <p>本成果物は、実際にドンジャラをプレイしている最中に使用することを想定し、スマートフォン上で操作が完結することを必須条件とした。<br>
  そのうえでユーザーの操作回数をなるべく減らすことを主眼に置いた。</p>
  <p>アプローチは2段階に分かれており、ステップ①がある程度の成果を発揮しつつも課題が残っていたため、ステップ②を実行した。</p>
  <p><strong>【ステップ①】ChatGPT単体での得点計算の実施</strong><br>
  ChatGPTであれば事前にルールや情報を共有し、手牌情報の画像を共有すれば推論できるのではないかと考えた。<br>
  プロジェクト機能でルール、得点計算フロー、牌一覧、役の成立条件をまとめたテーブルデータを共有し、それらを使用して得点計算を行うようプロンプトを作成した。</p>
  <p><strong>【ステップ②】Android用アプリの開発</strong><br>
  ChatGPT単体でもある程度の正答率を発揮したが、実用面で「複数のメッセージのやり取りが必要」「事前に共有したプロンプトから外れた処理を勝手に行う」「その日使えるChatGPTのモデルやバージョンによって返答にムラがある」などの課題が発生した。<br>
  そのためAndroidで動作する得点計算アプリを作成することで課題の解消を図った。<br>
  ステップ①で作成したプロンプトを基にKotlinのコードを生成し、アプリ開発を行った。</p>

  <h2>💻 使用言語・環境</h2>
  <p>使用ツール：ChatGPT<br>
  開発環境：AndoroidStudio<br>
  使用言語：Kotlin</p>

  <h2>📈 結果を何に活かせるのか</h2>
  <ul>
    <li>① 将来的にゴジラ以外のドンジャラNEOシリーズへの対応を行うことで、「ドンジャラには興味あるけど、得点計算が子供には難しいだろう」と考えているファミリー層の購買へのハードルを下げることができる。</li>
    <li>② テストが容易な生成AIを用いて作業手順削減のテストを行い、その結果を基に業務改善アプリの開発へと進むことで、より確実な工数削減を実行することができる。</li>
    <li>③ 得点計算を自動化することで、計算ミスを未然に防ぐことができる。</li>
  </ul>

  <h2>📊 効果</h2>

<h3>【制作物】</h3>
<p>Android用ドンジャラ得点計算アプリ</p>
<ul>
  <li>実際に娘（7歳）に使用させ、子供でも使用できることを確認</li>
  <li>実際のドンジャラプレイ時に複数回使用し、処理結果や処理速度に問題ないことを確認。</li>
</ul>

  <div class="screenshot-section">
  <h3>📱 実機画面</h3>
  <div style="display: flex; gap: 20px;">
    <figure>
      <img src="docs/01.png" alt="アプリ起動画面" style="height: 300px;">
      <figcaption>① アプリ起動画面</figcaption>
    </figure>
    <figure>
      <img src="docs/02.png" alt="撮影後の手牌確認" style="height: 300px;">
      <figcaption>② 撮影後の手牌確認</figcaption>
    </figure>
    <figure>
      <img src="docs/07.png" alt="計算結果画面" style="height: 300px;">
      <figcaption>③ 計算結果画面</figcaption>
    </figure>
  </div>
</div>


<p>ドンジャラの得点計算が可能なChatGPT用プロンプト</p>
<ul>
  <li>製作者が個人で使用するには十分な推論性能を発揮したものの、使い勝手が悪い。</li>
</ul>

<h3>【作業手順削減の状況】</h3>
<p>・通常のユーザーの作業</p>
<ol>
  <li>手牌完成</li>
  <li>手牌を構成するセットを確認</li>
  <li>説明書を見ながら基本役を確認</li>
  <li>説明書を見ながら加点役を確認</li>
  <li>得点を計算</li>
</ol>
<p>・アプリ使用時のユーザーの作業</p>
<ol>
  <li>手牌完成</li>
  <li>手牌を撮影</li>
  <li>得点を計算</li>
</ol>
<p>単純に比較した場合、40％の工数の削減に成功。</p>

<h3>【計算ミスの防止】</h3>
<p>得点計算を完全自動化することにより、計算ミスを完全に防ぐことに成功</p>

<h2>🔍 ステップ①について</h2>

<ol>
  <li>
    まず取扱説明書に記載のルール、得点計算フロー、基本役一覧、加点役一覧、牌一覧をテキストに起こし、ChatGPTがルールを守りフローに沿って処理できるか検証した。<br>
    ChatGPTのプロジェクトを使用して共有をした。<br>
    検証結果は失敗。ただテキストに起こしただけでは不明瞭な部分が多く、AIでは判断に悩んでしまった。
  </li>
  <li>
    ルールの文言を整理し、あいまいな部分を削減。<br>
    得点計算フローは明確に順序を設定し、必須処理や例外処理についても明確に記述し処理の優先順位を設けた。
  </li>
  <li>
    基本役一覧、加点役一覧、牌一覧はテーブルデータに整形し、得点計算フローで参照しやすいよう調整した。
  </li>
  <li>
    幾度もテストを行い、得点計算フローの文言を調整することでだんだんと処理を正確に実施できるようになっていった。
  </li>
  <li>
    プロジェクトだけではChatGPTが予想外の挙動をとることがあったため、カスタム指示を併用し、より正確に得点計算フローを実行するようにした。
  </li>
  <li>
    この段階で、下記の処理ができるようになり、計算結果の正答率も向上した：
    <ul>
      <li>スマホ上のChatGPTからカメラを起動</li>
      <li>手牌を撮影 → ChatGPTに得点計算を依頼</li>
      <li>ChatGPTが画像認識を行い、手牌の牌名を認識</li>
      <li>牌名と属性の一覧を生成、ユーザーへ正誤の確認を依頼</li>
      <li>ユーザーの返答を受けて手牌一覧を修正、得点計算を実施</li>
    </ul>
  </li>
  <li>
    しかし「複数のメッセージのやり取りが必要」「事前に共有したプロンプトから外れた処理を勝手に行う」「その日使えるChatGPTのモデルやバージョンによって返答にムラがある」などの課題が残っていたため、対応を検討し、ChatGPTと共有しているデータやプロンプトを活用してAndroid用アプリを作成できないか考えた。
  </li>
</ol>
<h2>📲 ステップ②について</h2>
<div style="display: flex; gap: 2em; align-items: flex-start; flex-wrap: wrap;">
  <div style="flex: 1; min-width: 300px;">
    <h3>ステップ②について</h3>
    <p>①プロジェクト内で必要なデータとプロンプトはChatGPTと共有できていたため、それらを実行できる処理をAndroid用アプリにするにはどうすればいいかを質問。質問応答の中で、「Kotlinを使用」「OCRにはGoogleMLKitを使用」など、アプリの方向性を決めていった。</p>
    <p>②開発環境としてAndroidStudioを用意し、ChatGPTに生成させたKotlin用のコードを実装。レイアウトや環境設定などの微調整を行いつつ、まずはメイン画面(DonjaraActivity)と得点計算ロジック(DonjaraCalculator)を作成した。</p>
    <p>③アプリが実機上でも問題なく稼働することを確認し、次にスマホのデフォルトカメラアプリの呼び出しとOCRによる文字認識の実装を行った。</p>
    <p>④カメラアプリの呼び出しと文字認識の実装が完了したため、UIやメッセージなどの調整を行った。実装した文字認識は精度が荒く、ユーザーへの確認画面の実装が必要となった。そこで認識結果を一覧表示させユーザーへの確認を行い、問題がある場合はプルダウンで一覧から正答を選択できるようにした。</p>
    <p>⑤この段階で当初予定していた機能すべての実装が完了した。想定ユーザーである娘(7歳)に実際に使用してもらい、使用感を教えてもらった。その後もテストを繰り返し、微調整を実施。これをもってアプリ完成と判断した。</p>
  </div>

  <div style="flex: 1; min-width: 300px;">
    <img src="docs/flow.png" alt="得点計算処理フロー" style="max-width: 100%; height: auto; border: 1px solid #ccc;">
    <p style="font-size: 0.9em; color: #555;">▲ ステップ②における得点計算処理フロー</p>
  </div>
</div>

  
<h2>🧠 工夫点・苦労点</h2>

<h3>【工夫点】</h3>
<ul>
  <li>
    <strong>属性オールマイティの扱いについて</strong><br>
    属性オールマイティはどの牌の代わりにも使用できる特殊な属性が存在した。<br>
    ※右図「特別なパイ」参照
    <ul>
      <li>アプローチ①においてもアプローチ②においても例外的な処理が必要になるため、対応に苦慮した。</li>
      <li>最終的には処理の方針として、「ユーザーにどの牌の代わりに使用するか入力させ、その入力を使用し手牌一覧を更新する」こととした。</li>
      <li>アプローチ②では、手牌確定時にオールマイティが含まれている場合、置き換え先選択画面を表示。ユーザーが任意の牌を選択し、確認画面で「はい」を選択すると確定された手牌が更新される処理を実装した。</li>
      <li>また、属性オールマイティは2枚存在するため、手牌に2枚含まれる場合がある。そのため置き換え処理は再帰ではなくループで行っている。</li>
    </ul>
  </li>

  <li>
    <strong>基本役ゴジラファイナルウォーズセットについて</strong><br>
    ※右図参照<br>
    基本役のゴジラファイナルウォーズセットは、基本役であるにもかかわらず、3セットの成立を必要としない特殊な役だった。<br>
    そのため基本役の判定を行う際、第一にゴジラファイナルウォーズセットの判定処理を行い、成立していなければその他の基本役の判定を行うようにした。
  </li>
</ul>

<h3>【苦労点】</h3>
<ul>
  <li>得点計算フローの内容の修正が非常に時間がかかったが、この修正に時間をかけたおかげで後のアプリ開発時の <code>DonjaraCalculator</code> 実装がスムーズに進んだ。</li>
  <li>Android用アプリ開発およびKotlinに関する知識も経験もないまま制作を開始したため、基礎知識の習得から始めなければならなかった。<br>
      実装作業中も都度コード内容を学習しつつ作業を進めた。<br>
      開発が完了した今は後追い学習を進めている。</li>
</ul>

<p>※右図はWEB取扱説明書から抜粋</p>

<h2>📈 今後の施策</h2>

<h3>【OCRの精度向上】</h3>
<p>現状のOCRでは文字認識の精度がやや低く、正答率は80％ほどである。そのため、以下のような施策が考えられる：</p>
<ul>
  <li>誤判定の多い牌名をリスト化し、文字認識を行うときにプログラム的なフォローを行う。</li>
  <li>OCRではなく画像認識を実装することで精度向上を図る。</li>
  <li>OCRと画像認識を併用し、さらに精度向上を図る。</li>
</ul>

<h3>【UIのクオリティアップ】</h3>
<p>UIはAndroidStudioで用意されているデフォルトのものを使用しているため、非常に簡素な外見になっている。</p>
<ul>
  <li>UI用のボタン等のパーツをよりグラフィカルなものにする。</li>
  <li>メッセージやボタン配置などのレイアウトをユーザー目線で調整する。</li>
</ul>
<p>これらの施策を行うことで一層のクオリティアップを狙うことができる。</p>

<h3>【他のドンジャラ製品への対応のための拡張性の用意】</h3>
<p>本成果物はドンジャラNEOゴジラのみを想定している。<br>
そこで他のドンジャラ製品（2025年3月末現在、販売終了も含め全14種類）に対応できるよう、<code>DonjaraCalculator</code> に汎用性を持たせ、他製品の牌一覧や役一覧のデータを入れても動作するよう拡張性を持たせる。</p>

  
</body>
</html>
